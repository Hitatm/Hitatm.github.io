---
layout: post
title: Data Link Layer 
category: Tech
tags: Network
keywords: 
description: live for now.
---

# 数据链路层     

|数据链路层|功能|
|--|--|
|LLC 数据链路控制层|LLC：主要功能 成帧、流量控制、差错控制|
|MAC 介质访问控制层|MAC：负责多路访问的控制|   


流量控制：是一系列的程序用来控制发送向接收方发送数据的数量。   
差错控制：是基于自动重复请求ARQ，检测到差错即需要按照一定规则重传数据帧。    
常见的流量控制：最基本的停等协议、GBN goback N ARQ、选择性重复的ARQ   
捎带技术；其中前三个数据都是单方向的由Sender->receiver;捎带技术是双向的数据传输。

## 流量控制
最简单的停等协议： 发数据、等ACK 、ACK序列号为0101交错的序列。       

GBN协议：m位的序列号，发送窗口小于等于2^m-1 序列号为mod(2^m);发送窗口不能大于2^m因为可能会导致发送2^m个帧后，Receiver 返回ACK丢失，Sender要回退滑动窗口N个，重发又从窗口的第一个数据帧开始向reveiver发送数据帧此时的序列号为0，但是这对于接收者其实是一个需要丢弃的副本，但是接收者需要接收序列号为0的数据，所以识别错误。    

选择性重复ARQ: 接收窗口为2^(m-1),接收时候不是按顺序来接收，接收方也存在一个接收窗口，接收窗口和发送窗口小于2^(m-1),因为如果大于2^m，那么接收方和发送方窗口之和将会跨越2^m序列号范围，会导致错误。
选择性ARQ的接收窗口的逻辑比GBN复杂了些：S：1 2 3 4 5 ；R： 2 3 4 5 ;R没有收到1，当收到2时会发NAK1要求重发1 收到3的时候就不会再继续发NAK1，也就是不用每次重复的发送没收到数据帧的NAK,为了减少网络拥堵。

|GBN|选择性重复ARQ|
|---|----|
|窗口最大2^m-1  |最大窗口2^(m-1)|
|定时器只需要一个，只需记录最先发送的数据帧收ACK是否超时|定时器需要多个，因为接收窗口数据帧有多个|
|不发NAK超时自动重传|如果没有收到需要发NAK|

捎带技术 :
双向数据传输，数据不止是S->R R->S  ACK可以插入到数据帧中 

## 多路复用
常见多路复用技术:

|随机访问|受控访问|通道协议|
|---|---|----|
|ALOHA/CSMA/CSMA-CD/CSMA-CA|预约、轮询、令牌环|FDMA、TDMA、CDMA|

### ALOHA
ALOHA 有数据即发送，发送中遇到冲突即回退等待，等待方式：二进制指数回退。
纯ALOHA：脆弱时间为2*T (T:为一帧平均传输时间), 即在在发送之后2T时间之内数据可能会产生冲突。
时隙ALOHA: 脆弱时间为T，每个发送时间为T。

### CSMA
载波侦听多路访问, 发送之前需要侦听一下链路中是否有数据。

### CSMA-CD
需要要求帧的最小长度限制。   
Tf为帧传输时间，Tp为帧的最大传播时延，其中需要Tf>2Tp;   
因为 从S->R 的数据帧传播的时间为Tp,由于传播时延，R未检测到数据
即发送数据此时当S接收到R发送的数据时候经历时间为2Tp。   
需要保证经过2*Tp时间此时S还在发送此帧的数据尚未结束，因为，如果在此帧数据的最后一位前发送如果没有检测到冲突，那么一旦整个帧发完了，同时冲突了，会导致S无法保存副本，而此时R收到为已经被冲突污染的帧。   


### CSMA-CA
带冲突检测的载波侦听多路访问，广泛应用于无线网络。    
流程：连续侦听-> 帧间空间-> 竞争窗口-> 发送帧 ->超时。

## 通道协议
FDMA、TDMA、CDMA 三种通道协议，移动电话系统比较常用。


## 标准以太网MAC层帧结构

|前导符preamble|SFD起始帧定界符|目的地址|源地址|长度或类型|数据字段|CRC|
|---|--|--|--|--|---|---|
|7byte 56bit的01序列其实是物理层添加的|1byte|6byte|6byte|2byte|46byte~1500byte|4 byte|

### 关于帧长度限制    
1. 以太网对帧的最大最小长度有严格的限定，最小64byte是为了满足CSMA-CD正确运行的需要：    
64 byte: 46byte + 6 byte + 6 byte+2 byte+ 4 byte=46+18byte  

时隙=往返时间+发送干扰序列所需时间     
在10Mbps的宽带上512 bits 发送时间t=51.2us。    
最大网络长度=2\* 10^8 \* (51.2 \* 10 ^(-6) /2 )=5120m。     
考虑中继器以及接收延时，理论值需要乘以48%，最大长度为2500m       

2. 最大帧长度为：1500+18=1518byte。   
设定最大值是为了：
    * 一个站点独占共享介质
    * 早期存储器昂贵，最大长度限制有助于减少缓冲器大小。




## 其他
Project 802 是用来被设计规范制造LAN以及不同LAN之间互联的标准。